create table customer (id bigint generated by default as identity, cpf varchar(255), customer_name varchar(255), email varchar(255), house_number varchar(255), phone varchar(255), street varchar(255), zip varchar(255), primary key (id));
create table customer_order (total numeric(38,2), customer_id bigint, id bigint generated by default as identity, primary key (id));
create table employee (id bigint generated by default as identity, password varchar(255), username varchar(255), primary key (id));
create table pizza (price numeric(38,2), id bigint generated by default as identity, flavor varchar(255), size varchar(255) check (size in ('MEDIUM','LARGE','EXTRA_LARGE')), primary key (id));
create table pizza_order (id bigint generated by default as identity, order_id bigint not null, pizza_id bigint not null, quantity bigint, primary key (id));
alter table if exists customer_order add constraint FKf9abd30bhiqvugayxlpq8ryq9 foreign key (customer_id) references customer;
alter table if exists pizza_order add constraint FKoqca1aov8a5nvqtk4px27yjdg foreign key (order_id) references customer_order;
alter table if exists pizza_order add constraint FKqo4nnh4h7iula92gq0wlmx1w3 foreign key (pizza_id) references pizza;
INSERT INTO customer (customer_name, cpf, email, phone, house_number, street, zip) VALUES ('Xam達 Cardoso Mendes Santos', '111-111-111.11', 'xama@gmail.com', '555-555', '3118', 'Rua dos Alfeneiros', '6400000');
INSERT INTO customer (customer_name, cpf, email, phone, house_number, street, zip) VALUES('Nicolas Rafalel', '222-222-222.22', 'nicolas@gmail.com', '685-555', '358', 'Rua dos Loucos Danados', '1233304');
INSERT INTO pizza (flavor, size, price) VALUES ('Carbonara', 'MEDIUM', 40.0);
INSERT INTO pizza (flavor, size, price) VALUES ('Portuguese', 'LARGE', 60.0);
INSERT INTO customer_order (customer_id) VALUES (1); -- Pedido de Xam達 Cardoso;
INSERT INTO customer_order (customer_id) VALUES (2); -- Pedido de Nicolas Rafalel;
INSERT INTO pizza_order (order_id, pizza_id, quantity) VALUES (1, 1, 2); -- 2 Carbonara para o pedido de Xam達;
INSERT INTO pizza_order (order_id, pizza_id, quantity) VALUES (1, 2, 1); -- 1 Portuguese para o pedido de Xam達;
INSERT INTO pizza_order (order_id, pizza_id, quantity) VALUES (2, 1, 3); -- 3 Carbonara para o pedido de Nicolas;
INSERT INTO pizza_order (order_id, pizza_id, quantity) VALUES (2, 2, 2); -- 2 Portuguese para o pedido de Nicolas;
UPDATE customer_order c SET total = ( SELECT SUM(pizza.price * pizza_order.quantity) FROM pizza_order JOIN pizza on pizza_order.pizza_id = pizza.id WHERE pizza_order.order_id = c.id) WHERE c.id IN (1,2);
